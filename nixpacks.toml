# Nixpacks configuration for Railway deployment
# Railway uses Nixpacks to build and deploy the application

[phases.setup]
nixPkgs = ["nodejs-20_x", "python311", "postgresql"]
nixLibs = ["glibc", "gcc", "stdenv.cc.cc"]
aptPkgs = ["chromium", "chromium-driver", "fonts-liberation"]

[phases.install]
cmds = [
  "echo '==> Installing Node.js dependencies...'",
  "npm install",
  "cd frontend && npm install && cd ..",
  "cd backend && npm install && cd ..",
  "echo '==> Installing Python dependencies for AI tools...'",
  "cd ai_tools && pip install -r requirements.txt && cd ..",
  "echo '==> Installing Python dependencies for scraping...'",
  "cd scraping && pip install -r requirements.txt && cd ..",
  "echo '==> Installing Playwright Chromium...'",
  "playwright install chromium",
  "echo '==> Generating Prisma Client...'",
  "cd database/prisma && npx prisma generate && cd ../.."
]

[phases.build]
cmds = [
  "echo '==> Building frontend...'",
  "cd frontend && npm run build && cd ..",
  "echo '==> Building backend...'",
  "cd backend && npm run build && cd .."
]

[start]
cmd = "npm run start:production"

[variables]
NODE_ENV = "production"
